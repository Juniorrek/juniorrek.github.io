<!DOCTYPE html>
<html>
<head>
    <title>Juniorrek</title>
    <link rel="stylesheet" type="text/css" href="css/font-awesome.min.css">
    <style type="text/css">
        .bg {
            background: #000;
        }
        .git {
            color: #2a085e;
            text-shadow: 1px 1px 1px #ccc;
            position: absolute; 
            left: calc(25% - 68.578px);
            top: calc(50% - 80px);
            z-index: 0;
        }
        .graphw {
            color: #2a085e;
            text-shadow: 1px 1px 1px #ccc;
            position: absolute; 
            left: calc(75% - 150px);
            top: calc(50% - 125px);
            z-index: 0;
        }
        canvas {
            background: none !important;
        }
        * {
            z-index: -1;
        }
    </style>
</head>
<body class="bg">
    <div style="position: absolute; top: 0; left: 0; width: 100%; height: 43%; background-image: url('media/starbg2.gif')">
    </div>
    <img src="media/mario.gif" style="position: absolute; top: 27px; z-index: 1;">
    <img src="media/mariobox.gif" style="position: absolute; top: 30px; right: 50%; z-index: 1;" width="46" height="46">
    <img src="media/donkeykong.gif" style="position: absolute; top: 16px; right: 13px; z-index: 1;">

    <iframe src="media/silence.mp3" allow="autoplay" id="audio" style="display:none"></iframe>
    </iframe> 
    <audio autoplay loop>
        <source src="media/music.ogg" type="audio/ogg">
    </audio>

    <a id="linkGit" href="https://github.com/Juniorrek"><i class="fa fa-github fa-5x git" aria-hidden="true"></i></a>
    <a id="linkGraphw" href="graphus2000.html"><img src="media/graphwLogo.png" class="graphw" width="150" height="150"></a>

    <img src="media/loading1.gif" style="position: absolute; bottom: 11px; z-index: 1;">
    <img src="media/construction.gif" style="position: absolute; bottom: 0; left: 36%; z-index: 1;">
    <div style="position: absolute; bottom: 0; left: 0; width: 100%; height: 21%; background-image: url('media/bgstar.gif')">

    <script src="js/matter.min.js"></script>
    <script type="text/javascript">
        // module aliases
        var Engine = Matter.Engine,
            Render = Matter.Render,
            World = Matter.World,
            Bodies = Matter.Bodies,
            Body = Matter.Body,
            Runner = Matter.Runner,
            Events = Matter.Events;

        // create an engine
        var engine = Engine.create();

        // create a renderer
        var render = Render.create({
            element: document.body,
            engine: engine,
            options: {
                background: 'none',
                width: window.innerWidth
            }
        });

        // create two boxes and a ground
        var boxA = Bodies.rectangle(200, 200, 80, 80, {id: 'player'});
        var boxB = Bodies.rectangle(460, 50, 80, 80);
        var ground = Bodies.rectangle(900, 610, window.innerWidth, 60, { isStatic: true, id: 'ground' });
        var gitBox = Bodies.rectangle(document.getElementsByClassName('git')[0].offsetLeft + 27
                                        , document.getElementsByClassName('git')[0].offsetTop + 33
                                        , 80, 80, { isStatic: true, id: 'git' });
        var graphBox = Bodies.rectangle(document.getElementsByClassName('graphw')[0].offsetLeft + 70
                                        , document.getElementsByClassName('graphw')[0].offsetTop + 63
                                        , 150, 150, { isStatic: true, id: 'graphw' });
        window.addEventListener("resize", function(){
            Body.setPosition(gitBox, { x: document.getElementsByClassName('git')[0].offsetLeft + 27,
                                       y: document.getElementsByClassName('git')[0].offsetTop + 33 });
            Body.setPosition(graphBox, { x: document.getElementsByClassName('graphw')[0].offsetLeft + 70,
                                       y: document.getElementsByClassName('graphw')[0].offsetTop + 63 });
        });

        // add all of the bodies to the world
        World.add(engine.world, [boxA, boxB, ground, gitBox, graphBox]);

        // run the engine
        Engine.run(engine);

        // run the renderer
        Render.run(render);

        // teclado
        var keyState = {};
        document.addEventListener("keydown", event => {
            if (event.isComposing || event.keyCode === 229) {
                return;
            }
            keyState[event.keyCode] = true;
        });
        document.addEventListener("keyup", event => {
            if (event.isComposing || event.keyCode === 229) {
                return;
            }
            keyState[event.keyCode] = false;
        });

        var runner = Runner.create();
        draw();

        function draw(){ 
            //Engine.update(engine, 1000/60, 1);     
            Runner.tick(runner, engine, 1000/60);
            
            keyboard();
            requestAnimationFrame(draw);
        }

        var inAir = false;
        function keyboard() {
            var x = boxA.position.x;
            var y = boxA.position.y;
            var vel = 5;
            if (keyState[65] || keyState[37]) {//A LEFT
                Body.setPosition(boxA, { x: x - vel, y: y });
            } 
            if (keyState[68] || keyState[39]) {//D RIGHT
                Body.setPosition(boxA, { x: x + vel, y: y });
            } 
            if (keyState[87] || keyState[38] || keyState[32]) {//W JUMP
                //Body.applyForce( boxA, {x: boxA.position.x, y: boxA.position.y}, {x: 0, y: -0.05});
                if (!inAir)
                    Body.setVelocity(boxA, { x: 0, y: -10 });
            }
        }

        // one jump
        Events.on(engine, 'collisionActive', function(event) {
            var pairs = event.pairs;

            // change object colours to show those starting a collision
            inAir = true;
            for (var i = 0; i < pairs.length; i++) {
                var pair = pairs[i];

                if (pair.bodyA.id === 'player' || pair.bodyB.id === 'player')
                    inAir = false;
            }
        });

        // links
        Events.on(engine, 'collisionStart', function(event) {
            var pairs = event.pairs;

            // change object colours to show those starting a collision
            for (var i = 0; i < pairs.length; i++) {
                var pair = pairs[i];

                console.log(pair);
                if (pair.bodyB.id === 'player' && pair.bodyA.id === 'git')
                    document.getElementById('linkGit').click();
                else if (pair.bodyB.id === 'player' && pair.bodyA.id === 'graphw')
                    document.getElementById('linkGraphw').click();
            }
        });
    </script>
</body>
</html>