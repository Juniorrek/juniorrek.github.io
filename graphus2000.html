<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">

    <title>The Randomizer Grapho 2000</title>
    <meta name="description" content="Random Graph Generator">
    <meta name="author" content="David">
    <style>
        #cy {
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0px;
            left: 0px;
        }
    </style>
</head>
<body>
    <div id="cy">
        
    </div>

    <script src="js/jquery-3.4.1.min.js"></script>
    <script src="js/cytoscape.min.js"></script>

    <script type="text/javascript">
        $(function() {
            var cy = cytoscape({
                container: $('#cy'), // container to render in

                elements: undefined,

                style: [ // the stylesheet for the graph
                    {
                        selector: 'node',
                        style: {
                            'background-color': '#666',
                            'label': 'data(id)'
                        }
                    },

                    {
                    selector: 'edge',
                        style: {
                            'width': 3,
                            'line-color': '#ccc',
                            'target-arrow-color': '#ccc',
                            'target-arrow-shape': 'triangle'
                        }
                    }
                ]
            });
            var layout = cy.layout({name: 'null'});

            function calcProbs(t, delta) {
                var probs = [];

                for (var i = 1; i <= t; i++) {
                    var prob = {};
                    prob.v = 'v'+i;

                    if (i == t) {
                        prob.p = (1+delta)/((t-1)*(2+delta)+(1+delta));
                    } else {
                        prob.p = (cy.$('#v'+i).degree()+delta)/((t-1)*(2+delta)+(1+delta));
                    }
                    probs.push(prob);
                }

                probs.sort(function(a, b){
                    if(a.p < b.p) return -1;
                    if(a.p > b.p) return 1;
                    return 0;
                });

                return probs;
            }

            function hofstadRandomGraph() {
                var m = 1;
                var times = 100;
                var delta = 1;

                layout.stop(); 
                for (var t = 1; t <= times; t++) {
                    var probs = calcProbs(t, delta);
                    var rand = Math.random();

                    var sump = 0;
                    for (var i = 0; i < probs.length; i++) {
                        sump += probs[i].p;
                        if (rand <= sump) {
                            cy.add([
                              { group: 'nodes', data: { id: 'v'+t }, position: { x: 100*t, y: 100*t } },
                              { group: 'edges', data: { id: 'e'+t, source: 'v'+t, target: probs[i].v } }
                            ]);
                            break;
                        }
                    }

                    
                }
                layout = cy.elements().makeLayout({name: 'circle'}); 
                layout.run();
            }
            console.log(cy);

            setTimeout(function(){ hofstadRandomGraph(); }, 500);
        });
    </script>
</body>
</html>